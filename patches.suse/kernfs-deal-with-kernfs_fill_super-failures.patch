From 6d1bc97b3371ff1045485ab0b5d97ec6db6089eb Mon Sep 17 00:00:00 2001
From: Al Viro <viro@zeniv.linux.org.uk>
Date: Tue, 3 Apr 2018 00:22:29 -0400
Subject: [PATCH] kernfs: deal with kernfs_fill_super() failures
References: bsc#1181809
Patch-mainline: v4.17-rc7
Git-commit: 82382acec0c97b91830fff7130d0acce4ac4f3f3

make sure that info->node is initialized early, so that kernfs_kill_sb()
can list_del() it safely.

Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
Reviewed-by: David Disseldorp <ddiss@suse.de>
---
 fs/kernfs/mount.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/fs/kernfs/mount.c b/fs/kernfs/mount.c
index 97dca0cdf937..70a1536b484a 100644
--- a/fs/kernfs/mount.c
+++ b/fs/kernfs/mount.c
@@ -320,6 +320,7 @@ struct dentry *kernfs_mount_ns(struct file_system_type *fs_type, int flags,
 
 	info->root = root;
 	info->ns = ns;
+	INIT_LIST_HEAD(&info->node);
 
 	sb = sget_userns(fs_type, kernfs_test_super, kernfs_set_super, flags,
 			 &init_user_ns, info);
-- 
2.26.2

